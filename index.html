<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metiri AI - Dashboard</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: white;
            color: black;
            padding: 20px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .header-content {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
        }
        
        .logo {
            height: 55px;
            width: auto;
            margin-right: 20px;
        }
        
        .header-text {
            display: flex;
            align-items: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 1.5em;
            font-weight: 400;
            letter-spacing: 0.5px;
            color: black;
        }
        
        .header-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .nav-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: transparent;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .nav-btn:hover {
            background: #f8f9fa;
            border-color: #d0d0d0;
            color: #333;
        }
        
        .nav-btn.active {
            background: #00BCD4;
            border-color: #00BCD4;
            color: white;
        }
        
        .nav-icon {
            width: 18px;
            height: 18px;
        }
        
        .page-content {
            padding: 20px;
            min-height: 800px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        iframe {
            width: 100%;
            height: 900px;
            border: none;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .hidden {
            display: none;
        }
        
        /* Users Page Styles */
        .users-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .user-card {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        
        .user-card:hover {
            border-color: #00BCD4;
            box-shadow: 0 4px 12px rgba(0, 188, 212, 0.1);
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #00BCD4, #009688);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .user-name {
            font-size: 18px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        
        .user-id {
            font-size: 12px;
            color: #666;
            font-family: monospace;
            margin-bottom: 15px;
        }
        
        .user-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }
        
        .user-actions .btn {
            flex: 1;
            min-width: 100px;
            text-align: center;
        }
        
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .btn-primary {
            background: #00BCD4;
            color: white;
        }
        
        .btn-primary:hover {
            background: #009688;
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #666;
            border: 1px solid #e0e0e0;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        /* Settings Page Styles */
        .settings-section {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
        }
        
        .settings-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
            margin-bottom: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
            box-sizing: border-box;
        }
        
        .form-input:focus {
            outline: none;
            border-color: #00BCD4;
        }
        
        .btn-large {
            padding: 12px 24px;
            font-size: 16px;
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #666;
        }
        
        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .empty-state-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
            color: #333;
        }
        
        .empty-state-text {
            font-size: 16px;
            margin-bottom: 30px;
        }
        
        /* User Details Page Styles */
        .user-details-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .user-info {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .user-avatar-large {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #00BCD4, #009688);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 32px;
            font-weight: 600;
        }
        
        .user-details-text h2 {
            margin: 0 0 8px 0;
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }
        
        .dashboard-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            background: #f8f9fa;
            padding: 8px;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }
        
        .toggle-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            flex: 1;
            justify-content: center;
        }
        
        .toggle-btn:hover {
            background: #f8f9fa;
            border-color: #d0d0d0;
            color: #333;
        }
        
        .toggle-btn.active {
            background: #00BCD4;
            border-color: #00BCD4;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <div class="header-left">
                    <img src="logometiri.png" alt="Metiri AI Logo" class="logo">
                    <div class="header-text">
                        <h1 id="pageTitle">Dashboard</h1>
                    </div>
                </div>
                <div class="header-nav">
                    <button class="nav-btn active" onclick="showPage('dashboard', this)">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                        </svg>
                        Dashboard
                    </button>
                    <button class="nav-btn" onclick="showPage('users', this)">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                        </svg>
                        Users
                    </button>
                    <button class="nav-btn" onclick="showPage('settings', this)">
                        <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19.14,12.94c0.04-0.3,0.06-0.61,0.06-0.94c0-0.32-0.02-0.64-0.07-0.94l2.03-1.58c0.18-0.14,0.23-0.41,0.12-0.61 l-1.92-3.32c-0.12-0.22-0.37-0.29-0.59-0.22l-2.39,0.96c-0.5-0.38-1.03-0.7-1.62-0.94L14.4,2.81c-0.04-0.24-0.24-0.41-0.48-0.41 h-3.84c-0.24,0-0.43,0.17-0.47,0.41L9.25,5.35C8.66,5.59,8.12,5.92,7.63,6.29L5.24,5.33c-0.22-0.08-0.47,0-0.59,0.22L2.74,8.87 C2.62,9.08,2.66,9.34,2.86,9.48l2.03,1.58C4.84,11.36,4.8,11.69,4.8,12s0.02,0.64,0.07,0.94l-2.03,1.58 c-0.18,0.14-0.23,0.41-0.12,0.61l1.92,3.32c0.12,0.22,0.37,0.29,0.59,0.22l2.39-0.96c0.5,0.38,1.03,0.7,1.62,0.94l0.36,2.54 c0.05,0.24,0.24,0.41,0.48,0.41h3.84c0.24,0,0.44-0.17,0.47-0.41l0.36-2.54c0.59-0.24,1.13-0.56,1.62-0.94l2.39,0.96 c0.22,0.08,0.47,0,0.59-0.22l1.92-3.32c0.12-0.22,0.07-0.47-0.12-0.61L19.14,12.94z M12,15.6c-1.98,0-3.6-1.62-3.6-3.6 s1.62-3.6,3.6-3.6s3.6,1.62,3.6,3.6S13.98,15.6,12,15.6z"/>
                        </svg>
                        Settings
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Dashboard Page -->
        <div id="dashboardPage" class="page-content">
            <div id="loading" class="loading">
                <h3>Loading Dashboard...</h3>
                <p>Please wait while we connect to our AI service.</p>
            </div>
            
            <div id="dashboardFrame">
                <iframe id="dashboardIframe" src=""></iframe>
            </div>
        </div>
        
        <!-- Users Page -->
        <div id="usersPage" class="page-content hidden">
            <h2>Users</h2>
            <div id="usersGrid" class="users-grid">
                <!-- Users will be populated here -->
            </div>
        </div>
        
        <!-- Settings Page -->
        <div id="settingsPage" class="page-content hidden">
            <div class="settings-section">
                <div class="settings-title">Add New User</div>
                <form id="addUserForm">
                    <div class="form-group">
                        <label class="form-label">User ID (UUID)</label>
                        <input type="text" id="newUserId" class="form-input" placeholder="Enter user UUID (e.g., 35e44797-4ec7-40ef-85fe-48da5a08431b)" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">User Name</label>
                        <input type="text" id="newUserName" class="form-input" placeholder="Enter user name" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-large">Add User</button>
                </form>
            </div>
        </div>
        
        <!-- User Details Page -->
        <div id="userDetailsPage" class="page-content hidden">
            <div class="user-details-header">
                <button class="btn btn-secondary" onclick="showPage('users')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                    </svg>
                    Back to Users
                </button>
                <div class="user-info">
                    <div class="user-avatar-large" id="userDetailsAvatar"></div>
                    <div class="user-details-text">
                        <h2 id="userDetailsName"></h2>
                        <p id="userDetailsId" class="user-id"></p>
                    </div>
                </div>
            </div>
            
            <div class="dashboard-toggle">
                <button class="toggle-btn active" onclick="switchUserDashboard('profile')" id="profileToggle">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                    Driver Profile
                </button>
                <button class="toggle-btn" onclick="switchUserDashboard('trip')" id="tripToggle">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                    </svg>
                    Trip Analysis
                </button>
            </div>
            
            <div id="userDashboardLoading" class="loading">
                <h3>Loading Dashboard...</h3>
                <p>Please wait while we connect to the user's data.</p>
            </div>
            
            <div id="userDashboardFrame">
                <iframe id="userDashboardIframe" src=""></iframe>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let users = [];
        let currentPage = 'dashboard';
        let currentUser = null;
        let currentUserDashboard = 'profile'; // 'profile' or 'trip'
        
        // Initialize the app
        window.addEventListener('load', function() {
            showPage('dashboard');
            generateFreshToken();
            loadUsersFromServer();
        });
        
        // Navigation functions
        function showPage(page, clickedButton = null) {
            // Hide all pages
            document.getElementById('dashboardPage').classList.add('hidden');
            document.getElementById('usersPage').classList.add('hidden');
            document.getElementById('settingsPage').classList.add('hidden');
            document.getElementById('userDetailsPage').classList.add('hidden');
            
            // Remove active class from all nav buttons
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            
            // Show selected page
            document.getElementById(page + 'Page').classList.remove('hidden');
            
            // Add active class to clicked button (if provided)
            if (clickedButton) {
                clickedButton.classList.add('active');
            } else {
                // Find the button for this page and activate it
                const button = document.querySelector(`[onclick="showPage('${page}')"]`);
                if (button) button.classList.add('active');
            }
            
            // Update page title
            const titles = {
                'dashboard': 'Dashboard',
                'users': 'Users',
                'settings': 'Settings',
                'userDetails': 'User Details'
            };
            document.getElementById('pageTitle').textContent = titles[page];
            
            currentPage = page;
        }
        
        // Dashboard functions
        async function generateFreshToken() {
            showLoading();
            
            try {
                const response = await fetch('https://extras.telematicssdk.com/dashboard/generate-token', {
                    method: 'POST',
                    headers: {
                        'X-API-KEY': 'RDFVUlYtYzJlZTFhZjYxYy0yMDI1MDcxNzA3NTcyNw==',
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        type: 'companyid',
                        id: '23951f8c-116e-461e-a676-304cd47dcb6b',
                        expirationtime: '60',
                        units: 'km',
                        language: 'en'
                    })
                });
                
                if (response.ok) {
                    const data = await response.json();
                    if (data.url) {
                        document.getElementById('dashboardIframe').src = data.url;
                        console.log('Fresh dashboard URL:', data.url);
                    } else {
                        throw new Error('No URL received from API');
                    }
                } else {
                    throw new Error(`API call failed: ${response.status}`);
                }
            } catch (error) {
                console.error('Error generating fresh token:', error);
            } finally {
                hideLoading();
            }
        }
        
        // User management functions
        async function loadUsersFromServer() {
            try {
                const response = await fetch('/api/users');
                if (response.ok) {
                    users = await response.json();
                    renderUsers();
                } else {
                    console.error('Failed to load users from server');
                    users = [];
                    renderUsers();
                }
            } catch (error) {
                console.error('Error loading users:', error);
                users = [];
                renderUsers();
            }
        }
        
        async function addUser(userId, userName) {
            try {
                const response = await fetch('/api/users', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userid: userId,
                        name: userName
                    })
                });
                
                if (response.ok) {
                    const newUser = await response.json();
                    users.push(newUser);
                    renderUsers();
                    return true;
                } else {
                    const errorData = await response.json();
                    alert(`Failed to add user: ${errorData.error}`);
                    return false;
                }
            } catch (error) {
                console.error('Error adding user:', error);
                alert(`Error adding user: ${error.message}`);
                return false;
            }
        }
        
        async function deleteUser(userId) {
            try {
                const response = await fetch(`/api/users/${userId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    users = users.filter(user => user.userid !== userId);
                    renderUsers();
                    return true;
                } else {
                    const errorData = await response.json();
                    alert(`Failed to delete user: ${errorData.error}`);
                    return false;
                }
            } catch (error) {
                console.error('Error deleting user:', error);
                alert(`Error deleting user: ${error.message}`);
                return false;
            }
        }
        
        // User Details functions
        async function openUserDetails(userId, dashboardType = 'profile') {
            const user = users.find(u => u.userid === userId);
            if (!user) {
                alert('User not found');
                return;
            }
            
            currentUser = user;
            currentUserDashboard = dashboardType;
            
            // Update user details display
            document.getElementById('userDetailsAvatar').textContent = user.name.charAt(0).toUpperCase();
            document.getElementById('userDetailsName').textContent = user.name;
            document.getElementById('userDetailsId').textContent = user.userid;
            
            // Update toggle buttons
            document.getElementById('profileToggle').classList.remove('active');
            document.getElementById('tripToggle').classList.remove('active');
            
            if (dashboardType === 'profile') {
                document.getElementById('profileToggle').classList.add('active');
            } else {
                document.getElementById('tripToggle').classList.add('active');
            }
            
            // Show the user details page
            showPage('userDetails');
            
            // Load the appropriate dashboard
            await loadUserDashboard(dashboardType);
        }
        
        async function switchUserDashboard(dashboardType) {
            if (!currentUser) return;
            
            currentUserDashboard = dashboardType;
            
            // Update toggle buttons
            document.getElementById('profileToggle').classList.remove('active');
            document.getElementById('tripToggle').classList.remove('active');
            
            if (dashboardType === 'profile') {
                document.getElementById('profileToggle').classList.add('active');
            } else {
                document.getElementById('tripToggle').classList.add('active');
            }
            
            // Load the appropriate dashboard
            await loadUserDashboard(dashboardType);
        }
        
        async function loadUserDashboard(dashboardType) {
            showUserDashboardLoading();
            
            try {
                let url = '';
                
                if (dashboardType === 'profile') {
                    // Generate driver profile token
                    const response = await fetch('https://extras.telematicssdk.com/token/driverprofile/generate_token', {
                        method: 'POST',
                        headers: {
                            'X-API-KEY': 'RDFVUlYtYzJlZTFhZjYxYy0yMDI1MDcxNzA3NTcyNw==',
                            'Content-Type': 'application/json',
                            'Accept': 'application/json'
                        },
                        body: JSON.stringify({
                            userid: currentUser.userid,
                            expiration_minutes: '60',
                            back_url: '23951f8c-116e-461e-a676-304cd47dcb6b',
                            units: 'km'
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.url) {
                            url = data.url;
                        } else {
                            throw new Error('No URL received from driver profile API');
                        }
                    } else {
                        throw new Error(`Driver profile API call failed: ${response.status}`);
                    }
                } else {
                    // Generate trip analysis token
                    const response = await fetch('/api/trip-analysis', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            userid: currentUser.userid
                        })
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.url) {
                            url = data.url;
                        } else {
                            throw new Error('No URL received from trip analysis API');
                        }
                    } else {
                        throw new Error(`Trip analysis API call failed: ${response.status}`);
                    }
                }
                
                // Load the URL in the iframe
                document.getElementById('userDashboardIframe').src = url;
                hideUserDashboardLoading();
                
            } catch (error) {
                console.error('Error loading user dashboard:', error);
                alert(`Error loading ${dashboardType === 'profile' ? 'driver profile' : 'trip analysis'}: ${error.message}`);
                hideUserDashboardLoading();
            }
        }
        
        function showUserDashboardLoading() {
            document.getElementById('userDashboardLoading').classList.remove('hidden');
            document.getElementById('userDashboardFrame').classList.add('hidden');
        }
        
        function hideUserDashboardLoading() {
            document.getElementById('userDashboardLoading').classList.add('hidden');
            document.getElementById('userDashboardFrame').classList.remove('hidden');
        }
        
        async function openTripAnalysis(userId) {
            try {
                console.log('Generating trip analysis for user:', userId);
                
                // Use our server-side API to avoid CORS issues
                const response = await fetch('/api/trip-analysis', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        userid: userId
                    })
                });
                
                console.log('Trip analysis response status:', response.status);
                
                if (response.ok) {
                    const data = await response.json();
                    console.log('Response data:', data);
                    if (data.url) {
                        window.open(data.url, '_blank');
                    } else {
                        alert('Failed to generate trip analysis URL - no URL in response');
                    }
                } else {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    alert(`Failed to generate trip analysis token: ${response.status} - ${errorText}`);
                }
            } catch (error) {
                console.error('Error generating trip analysis:', error);
                alert(`Error generating trip analysis: ${error.message}`);
            }
        }
        
        function renderUsers() {
            const usersGrid = document.getElementById('usersGrid');
            
            if (users.length === 0) {
                usersGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">👥</div>
                        <div class="empty-state-title">No Users Yet</div>
                        <div class="empty-state-text">Add your first user in the Settings page to get started.</div>
                    </div>
                `;
                return;
            }
            
            usersGrid.innerHTML = users.map(user => `
                <div class="user-card">
                    <div class="user-avatar">${user.name.charAt(0).toUpperCase()}</div>
                    <div class="user-name">${user.name}</div>
                    <div class="user-id">${user.userid}</div>
                    <div class="user-actions">
                        <button class="btn btn-primary" onclick="openUserDetails('${user.userid}', 'profile')">
                            View Profile
                        </button>
                        <button class="btn btn-primary" onclick="openUserDetails('${user.userid}', 'trip')">
                            Trip Analysis
                        </button>
                        <button class="btn btn-secondary" onclick="deleteUser('${user.userid}')">
                            Delete
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Form handling
        document.getElementById('addUserForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const userId = document.getElementById('newUserId').value.trim();
            const userName = document.getElementById('newUserName').value.trim();
            
            if (!userId || !userName) {
                alert('Please fill in all fields');
                return;
            }
            
            // Basic UUID validation
            const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;
            if (!uuidRegex.test(userId)) {
                alert('Please enter a valid UUID format');
                return;
            }
            
            // Check if user already exists
            if (users.some(user => user.userid === userId)) {
                alert('User with this ID already exists');
                return;
            }
            
            const success = await addUser(userId, userName);
            
            if (success) {
                // Clear form
                document.getElementById('newUserId').value = '';
                document.getElementById('newUserName').value = '';
                
                // Show success message
                alert('User added successfully!');
            }
        });
        
        // Utility functions
        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
        }
        
        function hideLoading() {
            document.getElementById('loading').classList.add('hidden');
        }
        
        // Handle iframe load events
        document.getElementById('dashboardIframe').addEventListener('load', function() {
            hideLoading();
        });
        
        document.getElementById('userDashboardIframe').addEventListener('load', function() {
            hideUserDashboardLoading();
        });
    </script>
</body>
</html> 